<div class="p-6 w-full min-h-screen"
  [ngClass]="theme === 'dark' ? 'bg-slate-900 text-slate-100' : 'bg-slate-50 text-slate-900'">

  <!-- Page header: title, user info, theme toggle, primary actions -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-0 mb-4">
    <div>
      <h1 class="text-2xl font-semibold mb-1" [ngClass]="theme === 'dark' ? 'text-slate-50' : 'text-slate-900'">
        Tasks
      </h1>
      <p class="text-sm" [ngClass]="theme === 'dark' ? 'text-slate-300' : 'text-gray-600'">
        Logged in as:
        <span class="font-medium">{{ currentUser?.email }}</span>
        <span class="ml-2 px-2 py-0.5 text-xs rounded border"
          [ngClass]="theme === 'dark' ? 'bg-slate-800 border-slate-600' : 'bg-gray-100 border-gray-300'">
          {{ currentUser?.role }}
        </span>
      </p>
    </div>

    <div class="flex items-center gap-2">
      <!-- Theme toggle -->
      <button type="button" (click)="toggleTheme()" class="px-2 py-1 text-xs border rounded hover:bg-gray-100"
        [ngClass]="theme === 'dark'
          ? 'bg-slate-800 border-slate-600 text-slate-100 hover:bg-slate-700'
          : 'bg-white border-gray-300 text-slate-900 hover:bg-gray-100'">
        {{ theme === 'dark' ? '‚òÄÔ∏è Light' : 'üåô Dark' }}
      </button>

      <!-- New task button (only for managers/admins) -->
      <button *ngIf="canManageTasks()" type="button" (click)="openCreateForm()"
        class="px-3 py-1.5 text-sm rounded bg-emerald-600 text-white hover:bg-emerald-700">
        + New Task
      </button>

      <!-- Manual refresh of the task list -->
      <button type="button" (click)="refresh()" class="px-3 py-1.5 text-sm border rounded" [ngClass]="theme === 'dark'
          ? 'bg-slate-800 border-slate-600 text-slate-100 hover:bg-slate-700'
          : 'bg-white border-gray-300 text-slate-900 hover:bg-gray-100'">
        Refresh
      </button>

      <!-- Logout button -->
      <button
        type="button"
        (click)="onLogout()
        "
        class="px-3 py-1.5 text-sm rounded"
        [ngClass]="theme === 'dark'
          ? 'bg-rose-700 text-white hover:bg-rose-800'
          : 'bg-rose-500 text-white hover:bg-rose-600'">
        Logout
      </button>

    </div>
  </div>

  <!-- Loading / Error states -->
  <div *ngIf="loading" class="py-8 text-center" [ngClass]="theme === 'dark' ? 'text-slate-300' : 'text-gray-500'">
    Loading tasks...
  </div>

  <div *ngIf="!loading && error" class="mb-4 p-3 border text-sm rounded" [ngClass]="theme === 'dark'
      ? 'border-rose-700 bg-rose-900/40 text-rose-100'
      : 'border-red-300 bg-red-50 text-red-700'">
    {{ error }}
  </div>

  <!-- Create / Edit form (only visible for users allowed to manage tasks) -->
  <div *ngIf="showForm && form && canManageTasks()" class="mb-4 border rounded p-4 shadow-sm"
    [ngClass]="theme === 'dark' ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-200'">
    <div class="flex items-center justify-between mb-3">
      <h2 class="text-lg font-semibold" [ngClass]="theme === 'dark' ? 'text-slate-50' : 'text-slate-900'">
        {{ isEditing ? 'Edit Task' : 'Create Task' }}
      </h2>
      <button type="button" (click)="cancelForm()" class="text-xs hover:underline"
        [ngClass]="theme === 'dark' ? 'text-slate-400 hover:text-slate-200' : 'text-gray-500 hover:text-gray-700'">
        ‚úï Close
      </button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Title -->
      <div>
        <label class="block text-xs font-medium mb-1" [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-700'">
          Title
        </label>
        <input type="text" [(ngModel)]="form.title" class="w-full border rounded px-2 py-1 text-sm" [ngClass]="theme === 'dark'
            ? 'bg-slate-900 border-slate-600 text-slate-100 placeholder-slate-500'
            : 'bg-white border-gray-300 text-slate-900 placeholder-gray-400'" placeholder="Task title" />
      </div>

      <!-- Category -->
      <div>
        <label class="block text-xs font-medium mb-1" [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-700'">
          Category
        </label>
        <input type="text" [(ngModel)]="form.category" class="w-full border rounded px-2 py-1 text-sm" [ngClass]="theme === 'dark'
            ? 'bg-slate-900 border-slate-600 text-slate-100 placeholder-slate-500'
            : 'bg-white border-gray-300 text-slate-900 placeholder-gray-400'" placeholder="e.g. Work, Personal" />
      </div>

      <!-- Description -->
      <div class="md:col-span-2">
        <label class="block text-xs font-medium mb-1" [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-700'">
          Description
        </label>
        <textarea rows="2" [(ngModel)]="form.description" class="w-full border rounded px-2 py-1 text-sm" [ngClass]="theme === 'dark'
            ? 'bg-slate-900 border-slate-600 text-slate-100 placeholder-slate-500'
            : 'bg-white border-gray-300 text-slate-900 placeholder-gray-400'"
          placeholder="Short description"></textarea>
      </div>

      <!-- Assignee -->
      <div>
        <label class="block text-xs font-medium mb-1" [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-700'">
          Assignee ID (optional)
        </label>
        <input type="number" [(ngModel)]="form.assigneeId" class="w-full border rounded px-2 py-1 text-sm" [ngClass]="theme === 'dark'
            ? 'bg-slate-900 border-slate-600 text-slate-100 placeholder-slate-500'
            : 'bg-white border-gray-300 text-slate-900 placeholder-gray-400'" placeholder="User ID" />
      </div>

      <!-- Status (shown only when editing an existing task) -->
      <div *ngIf="isEditing">
        <label class="block text-xs font-medium mb-1" [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-700'">
          Status
        </label>
        <select [(ngModel)]="form.status" class="w-full border rounded px-2 py-1 text-sm" [ngClass]="theme === 'dark'
            ? 'bg-slate-900 border-slate-600 text-slate-100'
            : 'bg-white border-gray-300 text-slate-900'">
          <option value="OPEN">OPEN</option>
          <option value="IN_PROGRESS">IN_PROGRESS</option>
          <option value="DONE">DONE</option>
        </select>
      </div>
    </div>

    <!-- Form footer actions -->
    <div class="mt-4 flex justify-end gap-2">
      <button type="button" (click)="cancelForm()" class="px-3 py-1.5 text-sm border rounded" [ngClass]="theme === 'dark'
          ? 'bg-slate-900 border-slate-600 text-slate-100 hover:bg-slate-800'
          : 'bg-white border-gray-300 text-slate-900 hover:bg-gray-50'">
        Cancel
      </button>
      <button type="button" (click)="submitForm()"
        class="px-3 py-1.5 text-sm rounded bg-emerald-600 text-white hover:bg-emerald-700">
        {{ isEditing ? 'Save Changes' : 'Create Task' }}
      </button>
    </div>
  </div>

  <!-- Empty state when there are no tasks -->
  <div *ngIf="!loading && !error && !tasks.length" class="py-8 text-center"
    [ngClass]="theme === 'dark' ? 'text-slate-400' : 'text-gray-500'">
    No tasks found.
  </div>

  <!-- Filters: search and status -->
  <div *ngIf="!loading && !error" class="mb-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
    <div class="flex items-center gap-2">
      <label class="text-xs" [ngClass]="theme === 'dark' ? 'text-slate-300' : 'text-gray-600'">
        Search:
      </label>
      <input type="text" class="border rounded px-2 py-1 text-sm" [ngClass]="theme === 'dark'
          ? 'bg-slate-900 border-slate-600 text-slate-100 placeholder-slate-500'
          : 'bg-white border-gray-300 text-slate-900 placeholder-gray-400'"
        placeholder="Title, description, assignee..." [(ngModel)]="searchText" (ngModelChange)="applyFilters()" />
    </div>

    <div class="flex items-center gap-2">
      <label class="text-xs" [ngClass]="theme === 'dark' ? 'text-slate-300' : 'text-gray-600'">
        Status:
      </label>
      <select class="border rounded px-2 py-1 text-sm" [(ngModel)]="statusFilter" (ngModelChange)="applyFilters()"
        [ngClass]="theme === 'dark'
          ? 'bg-slate-900 border-slate-600 text-slate-100'
          : 'bg-white border-gray-300 text-slate-900'">
        <option value="ALL">All</option>
        <option value="OPEN">OPEN</option>
        <option value="IN_PROGRESS">IN_PROGRESS</option>
        <option value="DONE">DONE</option>
      </select>
    </div>
  </div>

  <!-- Category filter -->
  <div class="flex items-center gap-2 mb-2">
    <label class="text-xs" [ngClass]="theme === 'dark' ? 'text-slate-300' : 'text-gray-600'">
      Category:
    </label>
    <select class="border rounded px-2 py-1 text-sm" [(ngModel)]="categoryFilter" (ngModelChange)="applyFilters()"
      [ngClass]="theme === 'dark'
        ? 'bg-slate-900 border-slate-600 text-slate-100'
        : 'bg-white border-gray-300 text-slate-900'">
      <option value="ALL">All</option>
      <option value="Work">Work</option>
      <option value="Personal">Personal</option>
      <option value="Other">Other</option>
    </select>
  </div>

  <!-- Status overview bar chart (high-level breakdown of task states) -->
  <div *ngIf="!loading && !error && taskStats.total" class="mt-4 mb-4 p-4 border rounded"
    [ngClass]="theme === 'dark' ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-200'">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-sm font-semibold" [ngClass]="theme === 'dark' ? 'text-slate-100' : 'text-gray-800'">
        Task Status Overview
      </h2>
      <span class="text-xs" [ngClass]="theme === 'dark' ? 'text-slate-400' : 'text-gray-500'">
        Total: {{ taskStats.total }}
      </span>
    </div>

    <div class="space-y-3">
      <!-- Open -->
      <div>
        <div class="flex items-center justify-between text-[11px] mb-1">
          <span class="font-medium" [ngClass]="theme === 'dark' ? 'text-slate-100' : 'text-gray-700'">
            Open
          </span>
          <span [ngClass]="theme === 'dark' ? 'text-slate-400' : 'text-gray-500'">
            {{ taskStats.open }} ({{ getPercentage(taskStats.open) }}%)
          </span>
        </div>
        <div class="w-full h-2 rounded overflow-hidden" [ngClass]="theme === 'dark' ? 'bg-slate-900' : 'bg-gray-100'">
          <div class="h-full bg-yellow-400" [style.width.%]="getPercentage(taskStats.open)"></div>
        </div>
      </div>

      <!-- In Progress -->
      <div>
        <div class="flex items-center justify-between text-[11px] mb-1">
          <span class="font-medium" [ngClass]="theme === 'dark' ? 'text-slate-100' : 'text-gray-700'">
            In Progress
          </span>
          <span [ngClass]="theme === 'dark' ? 'text-slate-400' : 'text-gray-500'">
            {{ taskStats.inProgress }} ({{ getPercentage(taskStats.inProgress) }}%)
          </span>
        </div>
        <div class="w-full h-2 rounded overflow-hidden" [ngClass]="theme === 'dark' ? 'bg-slate-900' : 'bg-gray-100'">
          <div class="h-full bg-blue-400" [style.width.%]="getPercentage(taskStats.inProgress)"></div>
        </div>
      </div>

      <!-- Done -->
      <div>
        <div class="flex items-center justify-between text-[11px] mb-1">
          <span class="font-medium" [ngClass]="theme === 'dark' ? 'text-slate-100' : 'text-gray-700'">
            Done
          </span>
          <span [ngClass]="theme === 'dark' ? 'text-slate-400' : 'text-gray-500'">
            {{ taskStats.done }} ({{ getPercentage(taskStats.done) }}%)
          </span>
        </div>
        <div class="w-full h-2 rounded overflow-hidden" [ngClass]="theme === 'dark' ? 'bg-slate-900' : 'bg-gray-100'">
          <div class="h-full bg-green-500" [style.width.%]="getPercentage(taskStats.done)"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tasks table (sortable, draggable, RBAC-aware actions) -->
  <div *ngIf="!loading && !error && tasks.length" class="overflow-x-auto border rounded"
    [ngClass]="theme === 'dark' ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-200'">
    <table class="min-w-full text-xs sm:text-sm">
      <thead
        [ngClass]="theme === 'dark' ? 'bg-slate-900 border-b border-slate-700' : 'bg-gray-50 border-b border-gray-200'">
        <tr>
          <!-- Edit column (or placeholder for non-managers) -->
          <th *ngIf="canManageTasks()" class="px-4 py-2 text-left font-medium"
            [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-700'">
            Edit
          </th>
          <th *ngIf="!canManageTasks()" class="px-4 py-2"></th>

          <!-- Sortable headers -->
          <th class="px-4 py-2 text-left font-medium cursor-pointer select-none hidden sm:table-cell"
            (click)="sortTasks('title')" [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-700'">
            <span class="inline-flex items-center">
              Title
              <span class="ml-1 text-[10px] transition-transform duration-150" [ngClass]="{
                  'text-gray-400':
                    theme !== 'dark' && sortColumn !== 'title',
                  'text-slate-500':
                    theme === 'dark' && sortColumn !== 'title',
                  'text-gray-600':
                    theme !== 'dark' && sortColumn === 'title',
                  'text-slate-200':
                    theme === 'dark' && sortColumn === 'title',
                  'rotate-180':
                    sortColumn === 'title' && sortDirection === 'desc'
                }">
                ‚ñ≤
              </span>
            </span>
          </th>

          <th class="px-4 py-2 text-left font-medium cursor-pointer select-none hidden sm:table-cell"
            (click)="sortTasks('description')" [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-700'">
            <span class="inline-flex items-center">
              Description
              <span class="ml-1 text-[10px] transition-transform duration-150" [ngClass]="{
                  'text-gray-400':
                    theme !== 'dark' && sortColumn !== 'description',
                  'text-slate-500':
                    theme === 'dark' && sortColumn !== 'description',
                  'text-gray-600':
                    theme !== 'dark' && sortColumn === 'description',
                  'text-slate-200':
                    theme === 'dark' && sortColumn === 'description',
                  'rotate-180':
                    sortColumn === 'description' && sortDirection === 'desc'
                }">
                ‚ñ≤
              </span>
            </span>
          </th>

          <th class="px-4 py-2 text-left font-medium cursor-pointer select-none hidden sm:table-cell"
            (click)="sortTasks('category')" [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-700'">
            <span class="inline-flex items-center">
              Category
              <span class="ml-1 text-[10px] transition-transform duration-150" [ngClass]="{
                  'text-gray-400':
                    theme !== 'dark' && sortColumn !== 'category',
                  'text-slate-500':
                    theme === 'dark' && sortColumn !== 'category',
                  'text-gray-600':
                    theme !== 'dark' && sortColumn === 'category',
                  'text-slate-200':
                    theme === 'dark' && sortColumn === 'category',
                  'rotate-180':
                    sortColumn === 'category' && sortDirection === 'desc'
                }">
                ‚ñ≤
              </span>
            </span>
          </th>

          <th class="px-4 py-2 text-left font-medium cursor-pointer select-none hidden sm:table-cell w-[110px]"
            (click)="sortTasks('status')" [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-700'">
            <span class="inline-flex items-center">
              Status
              <span class="ml-1 text-[10px] transition-transform duration-150" [ngClass]="{
        'text-gray-400': theme !== 'dark' && sortColumn !== 'status',
        'text-slate-500': theme === 'dark' && sortColumn !== 'status',
        'text-gray-600': theme !== 'dark' && sortColumn === 'status',
        'text-slate-200': theme === 'dark' && sortColumn === 'status',
        'rotate-180': sortColumn === 'status' && sortDirection === 'desc'
      }">
                ‚ñ≤
              </span>
            </span>
          </th>

          <th class="px-4 py-2 text-left font-medium cursor-pointer select-none hidden sm:table-cell"
            (click)="sortTasks('assignee')" [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-700'">
            <span class="inline-flex items-center">
              Assignee
              <span class="ml-1 text-[10px] transition-transform duration-150" [ngClass]="{
                  'text-gray-400':
                    theme !== 'dark' && sortColumn !== 'assignee',
                  'text-slate-500':
                    theme === 'dark' && sortColumn !== 'assignee',
                  'text-gray-600':
                    theme !== 'dark' && sortColumn === 'assignee',
                  'text-slate-200':
                    theme === 'dark' && sortColumn === 'assignee',
                  'rotate-180':
                    sortColumn === 'assignee' && sortDirection === 'desc'
                }">
                ‚ñ≤
              </span>
            </span>
          </th>

          <th class="px-4 py-2 text-left font-medium cursor-pointer select-none hidden sm:table-cell"
            (click)="sortTasks('createdBy')" [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-700'">
            <span class="inline-flex items-center">
              Created By
              <span class="ml-1 text-[10px] transition-transform duration-150" [ngClass]="{
                  'text-gray-400':
                    theme !== 'dark' && sortColumn !== 'createdBy',
                  'text-slate-500':
                    theme === 'dark' && sortColumn !== 'createdBy',
                  'text-gray-600':
                    theme !== 'dark' && sortColumn === 'createdBy',
                  'text-slate-200':
                    theme === 'dark' && sortColumn === 'createdBy',
                  'rotate-180':
                    sortColumn === 'createdBy' && sortDirection === 'desc'
                }">
                ‚ñ≤
              </span>
            </span>
          </th>

          <!-- Progress actions column header -->
          <th class="px-4 py-2 text-left font-medium" [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-700'">
            Progress
          </th>

          <!-- Delete column header (only when user can delete) -->
          <th *ngIf="canManageTasks()" class="px-4 py-2 text-center font-medium"
            [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-700'">
            Delete
          </th>

          <!-- Placeholder cell for users who can't delete -->
          <th *ngIf="!canDeleteTask(null!)" class="px-4 py-2"></th>
        </tr>
      </thead>

      <!-- Draggable task rows -->
      <tbody cdkDropList (cdkDropListDropped)="drop($event)">
        <tr *ngFor="let t of tasks" cdkDrag class="last:border-0" [ngClass]="
            theme === 'dark'
              ? 'border-b border-slate-700 hover:bg-slate-800'
              : 'border-b border-gray-200 hover:bg-gray-50'
          ">
          <!-- Edit / Drag -->
          <td class="px-4 py-2">
            <div class="flex items-center gap-1">
              <!-- Drag handle -->
              <span cdkDragHandle class="cursor-move text-xs"
                [ngClass]="theme === 'dark' ? 'text-slate-500 hover:text-slate-300' : 'text-gray-300 hover:text-gray-500'"
                title="Drag to reorder">
                ‚áÖ
              </span>

              <!-- Edit button (only for managers/admins) -->
              <button *ngIf="canManageTasks()" class="px-2 py-0.5 text-xs rounded border" [ngClass]="theme === 'dark'
                  ? 'border-indigo-500 text-indigo-300 hover:bg-indigo-900/40'
                  : 'border-indigo-300 text-indigo-700 hover:bg-indigo-50'" (click)="openEditForm(t)">
                ‚úèÔ∏è
              </button>
            </div>
          </td>

          <!-- Title -->
          <td class="px-4 py-2 font-medium" [ngClass]="theme === 'dark' ? 'text-slate-50' : 'text-gray-900'">
            {{ t.title }}
          </td>

          <!-- Description -->
          <td class="px-4 py-2 hidden sm:table-cell" [ngClass]="theme === 'dark' ? 'text-slate-300' : 'text-gray-700'">
            {{ t.description }}
          </td>

          <!-- Category -->
          <td class="px-4 py-2">
            <ng-container *ngIf="t.category; else noCategory">
              <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium border" [ngClass]="theme === 'dark'
                  ? 'bg-slate-900 border-slate-600 text-slate-100'
                  : 'bg-slate-50 border-slate-200 text-slate-700'">
                {{ t.category }}
              </span>
            </ng-container>
            <ng-template #noCategory>
              <span class="text-xs" [ngClass]="theme === 'dark' ? 'text-slate-500' : 'text-gray-400'">
                Uncategorized
              </span>
            </ng-template>
          </td>

          <!-- Status pill -->
          <td class="px-4 py-2 text-left w-[110px]">
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium border whitespace-nowrap"
              [ngClass]="{
      'bg-blue-50 border-blue-200 text-blue-700': t.status === 'OPEN' && theme !== 'dark',
      'bg-yellow-50 border-yellow-200 text-yellow-700': t.status === 'IN_PROGRESS' && theme !== 'dark',
      'bg-green-50 border-green-200 text-green-700': t.status === 'DONE' && theme !== 'dark',

      'bg-blue-900/40 border-blue-500 text-blue-200': t.status === 'OPEN' && theme === 'dark',
      'bg-yellow-900/40 border-yellow-500 text-yellow-200': t.status === 'IN_PROGRESS' && theme === 'dark',
      'bg-green-900/40 border-green-500 text-green-200': t.status === 'DONE' && theme === 'dark'
    }">
              {{ t.status }}
            </span>
          </td>

          <!-- Assignee -->
          <td class="px-4 py-2" [ngClass]="theme === 'dark' ? 'text-slate-200' : 'text-gray-800'">
            {{ t.assignee?.name || t.assignee?.email || 'Unassigned' }}
          </td>

          <!-- Created By -->
          <td class="px-4 py-2 hidden sm:table-cell" [ngClass]="theme === 'dark' ? 'text-slate-300' : 'text-gray-700'">
            {{ t.createdBy?.name || t.createdBy?.email || 'Unknown' }}
          </td>

          <!-- Progress actions: change status based on current state and RBAC -->
          <td class="px-4 py-2">
            <div class="flex items-center gap-1">
              <ng-container *ngIf="canChangeStatus(t)">
                <button *ngIf="t.status === 'OPEN'" class="px-2 py-0.5 text-xs rounded border" [ngClass]="theme === 'dark'
                ? 'border-sky-500 text-sky-200 hover:bg-sky-900/40'
                : 'border-sky-300 text-sky-700 hover:bg-sky-50'" (click)="updateStatus(t.id, 'IN_PROGRESS')">
                  Start
                </button>
                <button *ngIf="t.status === 'IN_PROGRESS'" class="px-2 py-0.5 text-xs rounded border" [ngClass]="theme === 'dark'
                ? 'border-emerald-500 text-emerald-200 hover:bg-emerald-900/40'
                : 'border-emerald-300 text-emerald-700 hover:bg-emerald-50'" (click)="updateStatus(t.id, 'DONE')">
                  Complete
                </button>
                <button *ngIf="t.status === 'DONE'" class="px-2 py-0.5 text-xs rounded border" [ngClass]="theme === 'dark'
                ? 'border-slate-500 text-slate-200 hover:bg-slate-900/40'
                : 'border-slate-300 text-slate-700 hover:bg-slate-50'" (click)="updateStatus(t.id, 'OPEN')">
                  Reopen
                </button>
              </ng-container>
            </div>
          </td>

          <!-- Delete -->
          <td class="px-4 py-2 text-center align-middle">
            <div class="flex items-center justify-center gap-1">
              <!-- Delete button only if current user is allowed -->
              <button *ngIf="canDeleteTask(t)" class="px-2 py-0.5 text-xs rounded border" [ngClass]="theme === 'dark'
        ? 'border-rose-500 text-rose-200 hover:bg-rose-900/40'
        : 'border-rose-300 text-rose-700 hover:bg-rose-50'" (click)="deleteTask(t.id)">
                üóëÔ∏è
              </button>
            </div>
          </td>

        </tr>
      </tbody>
    </table>
  </div>
</div>
